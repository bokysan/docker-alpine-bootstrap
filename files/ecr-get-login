#!/usr/bin/env bash
# Return a docker login line
set -e

data=$(ecr-get-authorization-token)
token="$(echo "$data" | jq '.authorizationData[0].authorizationToken' | base64 -d -)"
export ECR_USERNAME=$(echo "$token" | cut -d: -f1)
export ECR_PASSWORD=$(echo "$token" | cut -d: -f2-)
export ECR_REGISTRY=$(echo "$data" | jq '.authorizationData[0].proxyEndpoint')

echo "docker login -u $ECR_USERNAME -p $ECR_PASSWORD $ECR_REGISTRY"